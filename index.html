<!DOCTYPE html>
<html>
  <head>
    <title>AR/VR Learning</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img   id="display-img" src="ARVR_Learning_Background.png">
        <img   id="rainbow-img" src="rainbow.png">
        <audio id="bg-audio"    src="sentences%20unfinished.m4a" preload="auto" loop></audio>
      </a-assets>

      <!-- â”€â”€ Day environment (camera faces -Z) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <a-box      id="box"      position="-1 0.5 -3"  rotation="0 45 0"  color="#304ffe"></a-box>
      <a-sphere   id="sphere"   position="0 1.25 -5"  radius="1.25"      color="#ff1d89"></a-sphere>
      <a-cylinder id="cylinder" position="1 0.75 -3"  radius="0.5" height="1.5" color="#ffec00"></a-cylinder>
      <a-plane    id="plane"    position="0 0 -4"     rotation="-90 0 0" width="4" height="4" color="#bcf804"></a-plane>
      <a-plane    id="image-plane"         src="#display-img" position="0 1.25 -6"   width="5" height="5"></a-plane>
      <a-plane    id="image-plane-trigger" src="#rainbow-img"  position="0 1.25 -5.9" width="5" height="5"
                  material="transparent: true; opacity: 0"></a-plane>

      <!-- â”€â”€ Night environment (camera faces +Z after 180Â° rig rotation) â”€â”€â”€ -->
      <a-box      id="night-box"      position="1 0.5 3"   rotation="0 -45 0" color="#7c4dff" visible="false"></a-box>
      <a-sphere   id="night-sphere"   position="0 1.25 5"  radius="1.25"      color="#00e5ff" visible="false"></a-sphere>
      <a-cylinder id="night-cylinder" position="-1 0.75 3" radius="0.5" height="1.5" color="#ff6d00" visible="false"></a-cylinder>
      <a-plane    id="night-plane"    position="0 0 4"     rotation="-90 0 0" width="4" height="4" color="#1a237e" visible="false"
                  animation__move="property: position; from: -8 0 4; to: 8 0 4; dir: alternate; dur: 4000; loop: true; autoplay: false; easing: easeInOutSine"></a-plane>
      <a-plane    id="night-image-plane"         src="#display-img" position="0 1.25 6"   width="5" height="5" visible="false"></a-plane>
      <a-plane    id="night-image-plane-trigger" src="#rainbow-img"  position="0 1.25 5.9" width="5" height="5"
                  material="transparent: true; opacity: 0" visible="false"></a-plane>

      <a-sky id="sky" color="#ECECEC"></a-sky>

      <!-- Camera rig: holds world position and Y-rotation for environment switching.
           The inner camera handles look-controls and zoom movement independently. -->
      <a-entity id="camera-rig" position="0 1.6 0">
        <a-camera id="camera"></a-camera>
      </a-entity>
    </a-scene>

    <!-- Night mode toggle: circle button, upper-right viewport overlay -->
    <a id="myEnterARButton" href="#" title="Toggle Night Mode">ðŸ’¡</a>

    <!-- Mute button: below night mode button, upper-right viewport overlay -->
    <a id="muteBtn" href="#" title="Mute / Unmute">ðŸ”Š</a>

    <!-- Rainbow easter egg button: night-mode only, below mute button -->
    <a id="rainbowBtn" href="#" title="âœ¨ Easter Egg">ðŸŒˆ</a>

    <script>
      const btn        = document.querySelector('#myEnterARButton');
      const muteBtn    = document.querySelector('#muteBtn');
      const rainbowBtn = document.querySelector('#rainbowBtn');
      const cameraRig  = document.querySelector('#camera-rig');
      const sky        = document.querySelector('#sky');

      // Day environment elements (visibility-toggled only â€” no animations)
      const dayEls = [
        document.querySelector('#box'),
        document.querySelector('#sphere'),
        document.querySelector('#cylinder'),
        document.querySelector('#plane'),
        document.querySelector('#image-plane'),
        document.querySelector('#image-plane-trigger'),
      ];

      // Night environment elements
      const nightBox               = document.querySelector('#night-box');
      const nightSphere            = document.querySelector('#night-sphere');
      const nightCylinder          = document.querySelector('#night-cylinder');
      const nightPlane             = document.querySelector('#night-plane');
      const nightImagePlane        = document.querySelector('#night-image-plane');
      const nightImagePlaneTrigger = document.querySelector('#night-image-plane-trigger');

      // Night primitives that receive emissive glow + visibility toggling
      const nightPrimitives = [
        { el: nightBox,      glowColor: '#7c4dff' },
        { el: nightSphere,   glowColor: '#00e5ff' },
        { el: nightCylinder, glowColor: '#ff6d00' },
        { el: nightPlane,    glowColor: '#1a237e' },
      ];

      const bgAudio = document.querySelector('#bg-audio');

      let isNightMode    = false;
      let isMuted        = false;
      let isImageVisible = false;
      let triggerTimeout  = null;
      let triggerInterval = null;

      const EASTER_EGG_URL = 'rainbow.html';

      // Night environment resting positions / rotations
      const NIGHT_PLANE_ORIGIN  = '0 0 4';
      const NIGHT_SPHERE_ORIGIN = '0 1.25 5';
      const NIGHT_SPHERE_TARGET = '0 4 5';
      const NIGHT_BOX_ROTATION  = '0 -45 0';
      const CYLINDER_SCALE      = '1 1 1';

      // Fade the night trigger overlay in or out.
      function setImageTriggerFade(show) {
        isImageVisible = show;
        nightImagePlaneTrigger.removeAttribute('animation__fade');
        nightImagePlaneTrigger.setAttribute('animation__fade',
          'property: material.opacity; from: ' + (show ? 0 : 1) + '; to: ' + (show ? 1 : 0) +
          '; dur: 800; easing: ' + (show ? 'easeInSine' : 'easeOutSine'));
      }

      function startImageTrigger() {
        triggerTimeout = setTimeout(function () {
          setImageTriggerFade(true);
          triggerInterval = setInterval(function () {
            setImageTriggerFade(!isImageVisible);
          }, 3000);
        }, 3000);
      }

      function stopImageTrigger() {
        clearTimeout(triggerTimeout);
        clearInterval(triggerInterval);
        triggerTimeout  = null;
        triggerInterval = null;
        nightImagePlaneTrigger.removeAttribute('animation__fade');
        nightImagePlaneTrigger.setAttribute('material', 'opacity', 0);
        isImageVisible = false;
      }

      function setAudio(playing) {
        if (playing) {
          bgAudio.play().catch(function () {});
        } else {
          bgAudio.pause();
        }
      }

      function setMute(muted) {
        bgAudio.volume = muted ? 0 : 1;
        muteBtn.textContent = muted ? 'ðŸ”‡' : 'ðŸ”Š';
      }

      function setPlaneAnimation(playing) {
        nightPlane.setAttribute('animation__move', 'autoplay', playing);
      }

      function resetPlanePosition() {
        nightPlane.setAttribute('position', NIGHT_PLANE_ORIGIN);
      }

      function setCylinderPulse(pulsing) {
        if (pulsing) {
          nightCylinder.setAttribute('animation__pulse',
            'property: scale; from: 1 1 1; to: 1.5 0.6 1.5; dir: alternate; loop: true; dur: 600; easing: easeInOutSine');
        } else {
          nightCylinder.removeAttribute('animation__pulse');
          nightCylinder.setAttribute('scale', CYLINDER_SCALE);
        }
      }

      function setBoxSpin(spinning) {
        if (spinning) {
          nightBox.setAttribute('animation__spin',
            'property: rotation; from: 0 -45 0; to: 0 315 0; loop: true; dur: 4000; easing: linear');
        } else {
          nightBox.removeAttribute('animation__spin');
          nightBox.setAttribute('rotation', NIGHT_BOX_ROTATION);
        }
      }

      function setSpherePosition(rising) {
        if (rising) {
          nightSphere.removeAttribute('animation__fall');
          nightSphere.setAttribute('animation__rise',
            'property: position; to: ' + NIGHT_SPHERE_TARGET + '; dur: 2000; easing: easeInOutQuad');
        } else {
          nightSphere.removeAttribute('animation__rise');
          nightSphere.setAttribute('animation__fall',
            'property: position; to: ' + NIGHT_SPHERE_ORIGIN + '; dur: 2000; easing: easeInOutQuad');
        }
      }

      // â”€â”€ Night mode toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      btn.addEventListener('click', function (e) {
        e.preventDefault();
        isNightMode = !isNightMode;

        sky.setAttribute('color', isNightMode ? '#000000' : '#ECECEC');
        document.body.classList.toggle('night-mode', isNightMode);

        // Rotate the camera rig 180Â° to face the night environment, or back.
        // Using explicit from/to keeps the direction consistent on every toggle.
        cameraRig.removeAttribute('animation__turn');
        cameraRig.setAttribute('animation__turn',
          'property: rotation; ' +
          'from: 0 ' + (isNightMode ? 0 : 180) + ' 0; ' +
          'to: 0 '   + (isNightMode ? 180 : 0) + ' 0; ' +
          'dur: 1500; easing: easeInOutCubic');

        if (isNightMode) {
          // Hide day environment, reveal night environment
          dayEls.forEach(function (el) { el.setAttribute('visible', false); });
          nightPrimitives.forEach(function (p) {
            p.el.setAttribute('visible', true);
            p.el.setAttribute('material', 'emissive', p.glowColor);
            p.el.setAttribute('material', 'emissiveIntensity', 0.75);
          });
          nightImagePlane.setAttribute('visible', true);
          nightImagePlaneTrigger.setAttribute('visible', true);

          setPlaneAnimation(true);
          setSpherePosition(true);
          setBoxSpin(true);
          setCylinderPulse(true);
          setAudio(true);
          startImageTrigger();
        } else {
          // Reveal day environment, hide night environment
          dayEls.forEach(function (el) { el.setAttribute('visible', true); });
          nightPrimitives.forEach(function (p) {
            p.el.setAttribute('visible', false);
            p.el.setAttribute('material', 'emissiveIntensity', 0);
          });
          nightImagePlane.setAttribute('visible', false);
          nightImagePlaneTrigger.setAttribute('visible', false);

          setPlaneAnimation(false);
          resetPlanePosition();
          setSpherePosition(false);
          setBoxSpin(false);
          setCylinderPulse(false);
          setAudio(false);
          bgAudio.currentTime = 0;
          stopImageTrigger();

          // Reset rig position in case the zoom was used
          cameraRig.removeAttribute('animation__zoom');
          cameraRig.setAttribute('position', '0 1.6 0');
        }
      });

      // â”€â”€ Mute button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      muteBtn.addEventListener('click', function (e) {
        e.preventDefault();
        isMuted = !isMuted;
        setMute(isMuted);
      });

      // â”€â”€ Rainbow easter egg button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Zooms the camera rig toward the night image plane (+Z), then opens the URL.
      rainbowBtn.addEventListener('click', function (e) {
        e.preventDefault();
        cameraRig.removeAttribute('animation__zoom');

        function onZoomComplete() {
          cameraRig.removeEventListener('animationcomplete__zoom', onZoomComplete);
          window.open(EASTER_EGG_URL, '_blank');
        }
        cameraRig.addEventListener('animationcomplete__zoom', onZoomComplete);

        cameraRig.setAttribute('animation__zoom',
          'property: position; to: 0 1.25 6; dur: 2500; easing: easeInOutCubic');
      });
    </script>
  </body>
</html>
